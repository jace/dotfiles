# This is a minimal ~/.profile to bootstrap Homebrew if present.
# See ~/.zprofile and ~/.zshrc for the full environmment setup

# Flag for ~/.zprofile to avoid double sourcing
export DOT_PROFILE_SOURCED=1

# Setup Homebrew and $PATH
if [ "$OSTYPE" = linux-android ]; then
  # Do not probe root-level folders on Android.
  # Assume no Homebrew
  BREW_LOCATION=

# Disregard any `brew` already in the path and probe
# for specific folders. This avoids an edge case with
# macOS on Apple Silicon when Homebrew for Intel is
# also installed (for legacy formulae like python2.7).
# /usr/local/bin is in the default macOS $PATH and
# legacy Homebrew will take precedence.

elif [ -x /opt/homebrew/bin/brew ]; then
  # macOS on Apple Silicon
  BREW_LOCATION="/opt/homebrew/bin/brew"
elif [ -x /usr/local/bin/brew ]; then
  # Legacy macOS on Intel
  BREW_LOCATION="/usr/local/bin/brew"
elif [ -x /home/linuxbrew/.linuxbrew/bin/brew ]; then
  # Homebrew Linux global (formerly Linuxbrew)
  BREW_LOCATION="/home/linuxbrew/.linuxbrew/bin/brew"
elif [ -x "$HOME/.linuxbrew/bin/brew" ]; then
  # Homebrew Linux local
  BREW_LOCATION="$HOME/.linuxbrew/bin/brew"
else
  # No Homebrew
  BREW_LOCATION=
fi

# If we have Homebrew, setup its environment
if [ -n "$BREW_LOCATION" ]; then
  eval "$("$BREW_LOCATION" shellenv)"

  # Set HOMEBREW_PREFIX if necessary
  if [[ -z "$HOMEBREW_PREFIX" ]]; then
    export HOMEBREW_PREFIX="$(brew --prefix)"
  fi
fi
unset BREW_LOCATION
